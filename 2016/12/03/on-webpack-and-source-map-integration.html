<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]> ><! <![endif]-->
<html lang="en" class="">
  <head>
    <meta charset="utf-8">
    <title>On Webpack and Source Map integration |  Code.Art.Web</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta name="description" content="A comprehensive detour into the various devtools options in webpack">
    

    <link rel="canonical" href="http://lorefnon.me/2016/12/03/on-webpack-and-source-map-integration.html">
    <meta property="twitter:creator" content="@lorefnon">
    <meta property="og:title" content="@lorefnon">
    <meta property="og:type" content="blog">
    <meta poperty="og:url" content="http://lorefnon.me">
    <meta property="og:site_name" content="Code.Art.Web">
    <meta property="og:fb:app_id">
    <meta property="og:description" content="A comprehensive detour into the various devtools options in webpack">
    <link rel="alternate" type="application/rss+xml" href="http://lorefnon.me/feed.xml"/>
    <link rel="stylesheet" media="screen" type="text/css" href="/assets/stylesheets/reset.css"/>
    <link rel="stylesheet" media="screen" type="text/css" href="/assets/stylesheets/responsive.css"/>
    <link rel="stylesheet" media="screen" type="text/css" href="/assets/stylesheets/github.css"/>
    <link rel="stylesheet" media="screen" type="text/css" href="/assets/stylesheets/minimal_lightbox.css"/>
    <link rel="stylesheet" media="screen" type="text/css" href="/assets/stylesheets/styles.css"/>
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Raleway" rel='stylesheet' type='text/css'>
    <script>
  this.top.location !== this.location && (this.top.location = this.location);
</script>

  </head>
  <body style="zoom: 1;">
    <div class="main-container">

      <div class="mlogotype is-uppercase">
        <a href="http://lorefnon.me">Code.Art.Web</a>
      </div>

      <a href="http://lorefnon.me" class="home_logotype_link">
        <h1 class="tag">Code.Art.Web</h1>
      </a>

      <div class="header-container detail-view">
        <header class="main-header">
          <figure class="avatar">
            <a href="http://lorefnon.me"
            style="background-image: url();">Profile Picture</a>
          </figure>
          <h1 class="profile-name is-uppercase">
            <a href="http://lorefnon.me">Lorefnon</a>
          </h1>
        </header>
      </div>

      <div class="posts-container detail-view">
        <article class="post detail-view" id="">
          <h1 class="title"><a href="#">On Webpack and Source Map integration</a></h1>
          <a href="#" class="anchor-icon time-wrapper">
            <i class="fa fa-anchor"></i>
            <time>Dec 03, 2016</time>
          </a>

          
          <h2> <a class="header-link" href="#abstract" id="abstract"> Abstract </a> </h2>
          <p>A comprehensive detour into the various devtools options in webpack</p>

          

          

          <hr>

<p>Webpack is the forerunner in client side build tools. One of the important aspects that plays a key role in debuggability of javascript applications is source map integration - so we can debug the original source code even after transpilation.</p>

<p>Webpack has a <code>devtool</code> option which (just like everything in webpack) supports a variety of choices which can be beffudling even though the official documentation has a <a href="https://webpack.github.io/docs/configuration.html#devtool">dedicated section</a> on it.</p>

<p>Our primary focus would be on a babel transpiled project, though sourcemaps can be effectively used with many other compile-to-js languages like dart, coffeescript, opal(ruby) etc, as well as languages which target css.</p>

<hr>

<p>Before we delve into different supported <code>devtool</code> options, let us briefly look into how a webpack generated file typically looks like.</p>

<a class="header-link" href="#webpack-bootstrapper"><h1 id="webpack-bootstrapper">Webpack bootstrapper</h1></a>

<p>A typical bundle generated by webpack file is essentially an IIFE that is passed an array of compiled modules.</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">modules</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span> <span class="nx">bootstrapper</span> <span class="nx">goes</span> <span class="nx">here</span>
<span class="p">})([</span>
  <span class="p">...</span> <span class="nx">modules</span> <span class="nx">go</span> <span class="nx">here</span>
<span class="p">])</span>
</code></pre></div>
<p>The bootstrapper basically defines a minimal dependency loader <code>__webpack_require__</code> which is injected into each module . The entry module (modules[0]) is invoked first and uses <code>__webpack_require__</code> to load other dependencies (if any). Irrespective of whether the original source code used commonjs/amd/ES6 imports, they all are transpiled to use <code>__webpack_require__</code>.</p>

<a class="header-link" href="#different-devtool-options-"><h1 id="different-devtool-options-">Different devtool options:</h1></a>

<p>The documentation mentions following options as valid values for the devtool config, and outlines their characteristics in a helpful table:</p>

<div class="table-wrapper"><table>
<thead>
<tr>
<th>devtool</th>
<th>build speed</th>
<th>rebuild speed</th>
<th>production supported</th>
<th>quality</th>
</tr>
</thead>
<tbody>
<tr>
<td>eval</td>
<td>+++</td>
<td>+++</td>
<td>no</td>
<td>generated code</td>
</tr>
<tr>
<td>cheap-eval-source-map</td>
<td>+</td>
<td>++</td>
<td>no</td>
<td>transformed code (lines only)</td>
</tr>
<tr>
<td>cheap-source-map</td>
<td>+</td>
<td>o</td>
<td>yes</td>
<td>transformed code (lines only)</td>
</tr>
<tr>
<td>cheap-module-eval-source-map</td>
<td>o</td>
<td>++</td>
<td>no</td>
<td>original source (lines only)</td>
</tr>
<tr>
<td>cheap-module-source-map</td>
<td>o</td>
<td>-</td>
<td>yes</td>
<td>original source (lines only)</td>
</tr>
<tr>
<td>eval-source-map</td>
<td>–</td>
<td>+</td>
<td>no</td>
<td>original source</td>
</tr>
<tr>
<td>source-map</td>
<td>–</td>
<td>–</td>
<td>yes</td>
<td>original source</td>
</tr>
</tbody>
</table></div>

<p>The different dev-tools option provides different levels of ease of debuggability. We start with the most basic one:</p>

<a class="header-link" href="#eval"><h2 id="eval">eval</h2></a>

<p>| Each module is executed with eval and //@ sourceURL.</p>

<p>With eval each module entry in the modules array looks something like this:</p>
<div class="highlight"><pre><code class="js language-js" data-lang="js"><span class="nb">eval</span><span class="p">(</span><span class="s2">"'use strict';...generated code of index.js...//# sourceURL=webpack:///./index.js?"</span><span class="p">);</span>
</code></pre></div>
<p>In this mode the only mapping we have is at file level so exceptions point to the right file in the source code, but not to the right line number of original source code. But while debugging you are not really debugging the original code that you wrote.</p>

<p>It is not really a great choice for compiled code. It is possible to deal with it for languages which are semantically similar to ES2015 like coffeescript, livescript or basic babel compilation with async/await transforms because it is easy to mentally map the compiled source to original code, but it is advisable that we look into the other options below for easier debuggability.</p>

<p>It is notable that line number in exception stack traces not only don't match with original code before babel transpilation, it can potentially also not match with the babel transpiled code because of webpack specific transformations in post transpiled code. So we can not rely on our editor plugins' babel transpile feature to get the line numbers from exceptions.</p>

<p>It is however easy to copy a part of source code at any point, tweak it a bit and evaluate it in the javascript console - a feature, often taken for granted by developers habituated to vanilla javascript, that we loose in most of the other alternatives below.</p>

<p>Because of its simplicity it is very fast to be built.</p>

<p>However it should not be used in production because eval potentially <a href="http://stackoverflow.com/questions/86513/why-is-using-the-javascript-eval-function-a-bad-idea">disables</a> multiple performance optimizations that javascript engine performs.</p>

<a class="header-link" href="#cheap-eval-source-map"><h2 id="cheap-eval-source-map">cheap-eval-source-map</h2></a>

<p>The above table mentions the quality as transformed code (lines code). What this means is that the code visible in browser devtools is the code after being transformed by babel (or other loaders) but before final stage webpack specific transformations, which transforms the require statements to use <code>__webpack_require__</code>, injects errors for missing modules etc.</p>

<p>In this mode each module entry in the modules array looks something like this:</p>
<div class="highlight"><pre><code class="js language-js" data-lang="js"><span class="nb">eval</span><span class="p">(</span><span class="s2">"'use strict';...generated code of index.js ...//# sourceMappingURL=data:application/json;charset=utf-8;base64,...base 64 encoded string of sourcemap..."</span><span class="p">);</span>
</code></pre></div>
<p>The last part is a base64 encoded string of a JSON source map similar to the following:</p>
<div class="highlight"><pre><code class="json language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">"version"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
  <span class="nt">"file"</span><span class="p">:</span> <span class="s2">"0.js"</span><span class="p">,</span>
  <span class="nt">"sources"</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">"webpack:///./index.js?8920"</span>
  <span class="p">],</span>
  <span class="nt">"sourcesContent"</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">"'use strict';\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _reactDom = require('react-dom');\n\nfunction _interopRequireDefault(obj) { return obj &amp;&amp; obj.__esModule ? obj : { default: obj }; }\n\ndebugger;\n\n(0, _reactDom.render)(_react2.default.createElement(\n  'div',\n  null,\n  'Hello world'\n), document.getElementById('root'));\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./index.js\n// module id = 0\n// module chunks = 0"</span>
  <span class="p">],</span>
  <span class="nt">"mappings"</span><span class="p">:</span> <span class="s2">"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"</span><span class="p">,</span>
  <span class="nt">"sourceRoot"</span><span class="p">:</span> <span class="s2">""</span>
<span class="p">}</span>
</code></pre></div>
<p>The code in sourcesContent is the source code post babel transformation, so we can use editor plugin's babel transformation preview to get lines reported in exceptions.</p>

<p>Besides the above, the advantages and disadvantages are mostly the same as <code>eval</code> and is primarily only useful if the code being webpacked is vanilla javascript which is loaded through webpack. For debugging original source code before babel transforms other options are outlined below.</p>

<p>This should also not be used in production because of not only the eval related issues highlighted above, but also because generated code is separately embedded in the code which increases the size of bundle significantly. For production usage it is desirable that the source map be saved as separate files which are loaded on demand during debugging sessions.</p>

<p>While typically line numbers would not match with the original source code if loaders (like babel) are used for transformation, however babel has a option <code>retainLines</code> which will result in output structured in such a way that line numbers of transpiled code match original source line numbers. This obviously does not retain the column numbers.</p>

<p>In the example below we see a simple example of original and babel-transpiled code with retainLines=true</p>
<div class="highlight"><pre><code class="js language-js" data-lang="js"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">render</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">'react-dom'</span><span class="p">;</span>

<span class="nx">render</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
    <span class="nx">Hello</span> <span class="nx">world</span>
  <span class="o">&lt;</span><span class="err">/div&gt;,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div>
<div class="highlight"><pre><code class="js language-js" data-lang="js"><span class="s1">'use strict'</span><span class="p">;</span><span class="kd">var</span> <span class="nx">_react</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react'</span><span class="p">);</span><span class="kd">var</span> <span class="nx">_react2</span> <span class="o">=</span> <span class="nx">_interopRequireDefault</span><span class="p">(</span><span class="nx">_react</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">_reactDom</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react-dom'</span><span class="p">);</span><span class="kd">function</span> <span class="nx">_interopRequireDefault</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nx">obj</span> <span class="o">&amp;&amp;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">__esModule</span> <span class="o">?</span> <span class="nx">obj</span> <span class="o">:</span> <span class="p">{</span> <span class="k">default</span><span class="o">:</span> <span class="nx">obj</span> <span class="p">};}</span>

<span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">_reactDom</span><span class="p">.</span><span class="nx">render</span><span class="p">)(</span>
<span class="nx">_react2</span><span class="p">.</span><span class="k">default</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'div'</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s1">'Hello world'</span><span class="p">),</span>


<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'root'</span><span class="p">));</span>
</code></pre></div>
<a class="header-link" href="#cheap-source-map"><h2 id="cheap-source-map">cheap-source-map</h2></a>

<p>In this case eval is no longer used. And a single source map file is generated which is referred in the generated bundle through a line in the end like:</p>
<div class="highlight"><pre><code class="js language-js" data-lang="js"><span class="c1">//# sourceMappingURL=bundle.js.map</span>
</code></pre></div>
<p>The code visible in browser dev-tools is still babel-transpiled code, like the case with <code>cheap-eval-source-map</code>.</p>

<a class="header-link" href="#cheap-module-eval-source-map"><h2 id="cheap-module-eval-source-map">cheap-module-eval-source-map</h2></a>

<p>As mentioned in the name this uses eval but the source is the actual source code before babel transpilation. Though we get line level mapping individual expressions are not mapped to expressions in original source.</p>

<p>However because of the same reasons as cheap-eval-source-map (eval usage, source map embedded in generated bundle leading to increased size) it is not suitable for production usage.</p>

<a class="header-link" href="#cheap-module-source-map"><h2 id="cheap-module-source-map">cheap-module-source-map</h2></a>

<p>This is an evolution over the above in that we get rid of eval and move source maps to separate files making it sutable for production usage.</p>

<a class="header-link" href="#eval-source-map"><h3 id="eval-source-map">eval-source-map</h3></a>

<p>This maps to original source code at expression level, but uses eval making it suitable only for development.</p>

<a class="header-link" href="#source-map"><h2 id="source-map">source-map</h2></a>

<p>This has expression level mapping to original source code, does not use eval and is suitable for production. This is the best option for production usage.</p>

<hr>

<p>For the simple example above the sizes of different bundles and source maps are summarized below:</p>

<div class="table-wrapper"><table>
  <tr>
    <th>File</th>
<th>Size</th>
<th>Time taken for initial bundling</th>
  </tr>
  <tr>
    <td> bundle.eval.js</td>
<td>760K</td>
<td> 1603ms</td>
  </tr>
  <tr>
    <td> bundle.cheap-eval-source-map.js </td>
<td>1.9M</td>
<td>1888ms</td>
  </tr>
  <tr>
    <td>bundle.cheap-source-map.js</td>
<td>723K</td>
<td rowspan="2"> 1724ms</td>
  </tr>
  <tr>
    <td>bundle.cheap-source-map.js.map</td>
<td>841K</td>
  </tr>
  <tr>
    <td>bundle.cheap-module-eval-source-map.js</td>
<td>1.9M</td>
<td>1870ms</td>
  </tr>
  <tr>
    <td>bundle.cheap-module-source-map.js</td>
<td>723K</td>
<td rowspan="2">1756ms</td>
  </tr>
  <tr>
    <td>bundle.cheap-module-source-map.js.map</td>
<td>841K</td>
  </tr>
  <tr>
    <td>bundle.eval-source-map.js</td>
<td>1.9M</td>
<td>2127ms</td>
  </tr>
  <tr>
    <td>bundle.source-map.js</td>
<td>725K</td>
<td rowspan="2">2197ms</td>
  </tr>
  <tr>
    <td>bundle.source-map.js.map</td>
<td>844K</td>
  </tr>
</table></div>

<p>It is recommended to use separate webpack configurations for production and development. In development, when dealing with mostly well formatted source code <code>cheap-module-eval-source-map</code> is usually adequate where as in production it is good to have <code>source-map</code> as the devtool config.</p>

<a class="header-link" href="#selective-source-map-generation"><h1 id="selective-source-map-generation">Selective source map generation</h1></a>

<p>Webpack provides a <code>SourceMapDevToolPlugin</code> for greater control over which files source maps should be generated for.</p>

<a class="header-link" href="#about-pragma-styles"><h1 id="about-pragma-styles">About pragma styles</h1></a>

<p>The devtool configuration string can be prefixed with <code>#</code> or <code>@</code> to force a specific a pragma style. The latter is now deprecated by browser vendors. The reasoning behind this has been summarized by html5rocks:</p>

<blockquote>
<p>Previously the comment pragma was <code>//@</code> but due to some issues with that and <a href="https://www.html5rocks.com/en/tutorials/developertools/sourcemaps/#toc-issues">IE conditional compilation</a> comments the <a href="https://groups.google.com/forum/#!topic/mozilla.dev.js-sourcemap/4uo7Z5nTfUY">decision was made</a> to change it to <code>//#</code>. Currently Chrome Canary, WebKit Nightly and Firefox 24+ support the new comment pragma. This syntax change also affects sourceURL.</p>
</blockquote>

<p>Changing the prefix to <code>@</code> can help with debugging in older browsers</p>


<footer class="group">
  <p>
    
    
    
      
    
  </p>
</footer>
<div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//lorefnon-blog.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" class="disqus-link">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com" class="dsq-brlink disqus-link">comments powered by <span class="logo-disqus">Disqus</span></a>



        </article>
      </div>

      <div class="line hide-text">Separator line</div>

      <!-- Next article preview -->
      <div class="next-article" style="display: none;">
        <a href="#">
          <p class="read-next tag is-uppercase">Read this next:</p>
          <p class="next-article__title">Protocol and Language</p>
          <div class="next-article__content">
            <p>This is the second part of my series on protocol. The first part contained a lot of background information, but now we’re ready to get into what Protocol actually is. I live in a pretty unique place, the Farmhouse. It’s a... <span>Continue…</span></p>
          </div>
        </a>
      </div>
      <!-- Finish / Feature on process-->

      <div class="line hide-text">Separator line</div>

      <div class="foot_logo">
        <a href="http://lorefnon.me"><span class="logo"></span></a>
      </div>

      <div class="foot_logo right">
        <a href="/"><span class="link">Full Blog >></span></a>
      </div>

      <div class="line"></div>

<div class="foot_userbar">
  <div href="#" class="bottom_tagline">
    <span>Lorefnon</span>
    <br><br>
    <p> Full stack web developer and polyglot programmer with strong interest in dynamic languages, web application development and user experience design. </p>
    <br>
    <p> Strong believer in agile methodologies, behaviour driven development and efficacy of open source technologies.</p>
    <br>
  </div>
  <div class="profile-links-container">
  <a href="#" class="bottom_tagline"><span> You can reach me through :</span></h2>
  <br><br>
  <ul class="profile-links">
    <li class="twitter">
      <a href="http://twitter.com/lorefnon" target="_blank">
        <span>Twitter</span>
      </a>
    </li>
    <li class="linkedin">
      <a href="https://in.linkedin.com/in/gaurab-paul-a2472921" target="_blank">
        <span>Linkedin</span>
      </a>
    </li>
    <li class="github">
      <a href="https://github.com/lorefnon" target="_blank">
        <span>Github</span>
      </a>
    </li>
    <li class="github">
      <a href="mailto:lorefnon@gmail.com" target="_blank">
        <span>Email</span>
      </a>
    </li>
  </ul>

  </div>
</div>
<div class="line"></div>
<div class="foot_userbar">
  <p>&copy; 2013 - 2015 Gaurab Paul </p>
<br/>
<p>Code licensed under the
  <a href="http://opensource.org/licenses/MIT" target="_blank">The
    MIT License</a>. Content and Artwork licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA</a>.
</p>
<br/>
<p>
  The opinions expressed herein are my personal viewpoints  and may
  not be taken as professional recommendations from any of my previous or
  current employers.
</p>
<br/>
<p>
  Site is powered by <a href="http://jekyllrb.com/">Jekyll</a> and graciously hosted by <a href="https://github.com">Github</a>
</p>
<br/>
<br/>

</div>

    </div>

    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-47274059-1']);
  _gaq.push(['_setDomainName', 'lorefnon.me']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

    <script src="/assets/javascripts/post.js"></script>
  </body>
</html>
