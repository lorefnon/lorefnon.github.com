<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]> ><! <![endif]-->
<html lang="en" class="">
  <head>
    <meta charset="utf-8">
    <title>Effectively debugging KnockoutJS applications. |  Code.Art.Web</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <link rel="canonical" href="http://lorefnon.me/2012/08/12/effectively-debugging-knockoutjs-applications.html">
    <meta property="twitter:creator" content="@lorefnon">
    <meta property="og:title" content="@lorefnon">
    <meta property="og:type" content="blog">
    <meta poperty="og:url" content="http://lorefnon.me">
    <meta property="og:site_name" content="Code.Art.Web">
    <meta property="og:fb:app_id">
    <meta property="og:description" content="">
    <link rel="alternate" type="application/rss+xml" href="http://lorefnon.me/feed.xml"/>
    <!-- libraries -->
    <link rel="stylesheet" media="screen" type="text/css" href="/assets/stylesheets/reset.css"/>
    <link rel="stylesheet" media="screen" type="text/css" href="/assets/stylesheets/styles.css"/>
    <link rel="stylesheet" media="screen" type="text/css" href="/assets/stylesheets/responsive.css"/>
    <link rel="stylesheet" media="screen" type="text/css" href="/assets/stylesheets/github.css"/>
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
    
  </head>
  <body style="zoom: 1;">
    <div class="main-container">
      
      <div class="mlogotype is-uppercase">
        <a href="http://lorefnon.me">Code.Art.Web</a>
      </div>

      <a href="http://lorefnon.me" class="home_logotype_link">
        <h1 class="tag">Code.Art.Web</h1>
      </a>

      <div class="header-container detail-view">
        <header class="main-header">
          <figure class="avatar">
            <a href="http://lorefnon.me" 
            style="background-image: url();">Profile Picture</a> 
          </figure>
          <h1 class="profile-name is-uppercase">
            <a href="http://lorefnon.me">Lorefnon</a>
          </h1>
        </header>
      </div>

      <div class="posts-container detail-view">
        

<header class="post-header">
  <!-- <time datetime="2015-11-30 23:25:33 +0530">August 12, 2012</time> -->
</header>

<article class="post detail-view" id="">
  <h1 class="title"><a href="#">Effectively debugging KnockoutJS applications.</a></h1>
  <a href="#" class="anchor-icon">
    <i class="fa fa-anchor"></i>
    <time datetime="2015-11-30 23:25:33 +0530">Aug 12, 2012</time>
  </a>
  
    <p>This post aims to provide some explanation about the lifecycle of dynamic data-bindings in KnockoutJS to  ease debugging of KO applications .</p>

<p>A developer can remain perfectly oblivious of all that is going on under the hood and let the magic of declarative bindings do all the heavy-lifting of data-synchronization and it all works fine untill something unexpected happens. What now ? While most of the bugs in code can be directly resolved by inspecting the data-bind attributes manually, but if the complexity of application grows beyond a level an understanding of what goes on under the sheets becomes necessary.</p>

<p>While UI does appear to be getting magically updated when the models change, in reality the code underneath is all plain javascript. So what happens when something doesn’t turn out to be as expected ? Where do we start debugging from ?</p>

<p>The first and most obvious point of commencement is the observable. While we can (and sometimes might need to) begin from the observable function and dig down, debugging process is much simplified if we have a bit of familiarity with the way KO works internally. At this point I would like to underline that KO code is written very well and in general is easy to understand.</p>

<p>This knowledge is also helpful for development of custom bindings.</p>

<p>KO relies on bindingHandlers to manage bindings. So corresponding to every built in binding (eg. visible, text, html, value etc.)  we have a bindingHandler which has the same name. The text  binding is handled by a function <strong>ko.bindingHandlers.text</strong>, the value binding by <strong>ko.bindingHandlers.value</strong> and likewise.</p>

<p>Let us checkout a simple example :</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;jquery-1.7.1.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;knockout-latest.debug.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;index.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div&gt;</span>
      Please Enter your name :
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">data-bind=</span><span class="s">&quot;value:name&quot;</span><span class="nt">&gt;&lt;/input&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div&gt;</span>
      Hello <span class="nt">&lt;span</span> <span class="na">data-bind=</span><span class="s">&quot;text: name&quot;</span><span class="nt">&gt;&lt;/span&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>

<div class="highlight"><pre><code class="javascript"><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">vmodel</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">name</span><span class="o">:</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">observable</span><span class="p">(</span><span class="s2">&quot;Lorefnon&quot;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">ko</span><span class="p">.</span><span class="nx">applyBindings</span><span class="p">(</span><span class="nx">vmodel</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<p>There are two binders involved : text-binder and value-binder. Let us inspect the <strong>ko.bindingHandlers.text</strong>in javascript.   It has a single member : update function. Yes, you guessed it right – this is the function that is called when the span is to be updated. Let us checkout what it does :</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">ko</span><span class="p">.</span><span class="nx">bindingHandlers</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;update&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">valueAccessor</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ko</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">setTextContent</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">valueAccessor</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>

<p>The code is straightforward and self explanatory. You can just add a breakpoint to the update function and it will be triggered every time that particular DOM node is updated. As expected the actual DOM manipulation takes place in the <strong>ko.utils.setTextContent</strong></p>

<div class="highlight"><pre><code class="javascript"><span class="nx">setTextContent</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">textContent</span><span class="p">)</span> <span class="p">{</span>
     <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">unwrapObservable</span><span class="p">(</span><span class="nx">textContent</span><span class="p">);</span>
     <span class="k">if</span> <span class="p">((</span><span class="nx">value</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">value</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">))</span> <span class="nx">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
     <span class="s1">&#39;innerText&#39;</span> <span class="k">in</span> <span class="nx">element</span> <span class="o">?</span> <span class="nx">element</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">value</span> <span class="o">:</span> <span class="nx">element</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
     <span class="k">if</span> <span class="p">(</span><span class="nx">ieVersion</span> <span class="o">&gt;=</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
         <span class="c1">// Believe it or not, this actually fixes an IE9 rendering bug</span>
         <span class="c1">// (See https://github.com/SteveSanderson/knockout/issues/209)</span>
         <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="p">;</span>
     <span class="p">}</span>
<span class="p">},</span>
</code></pre></div>

<p>What about the other side of the code : What do you do to intercept a change in a form element ? Let us checkout the <strong>ko.bindingHandlers.value</strong></p>

<p><img src="/images/ko.png" /></p>

<p>As you probably have already guessed, the init function creates the bindings to intercept any change in the form element. The actual handler that is called each time when the input element changes its value is the valueUpdateHandler function defined inside init :</p>

<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">valueUpdateHandler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
     <span class="kd">var</span> <span class="nx">modelValue</span> <span class="o">=</span> <span class="nx">valueAccessor</span><span class="p">();</span>
     <span class="kd">var</span> <span class="nx">elementValue</span> <span class="o">=</span> <span class="nx">ko</span><span class="p">.</span><span class="nx">selectExtensions</span><span class="p">.</span><span class="nx">readValue</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
     <span class="nx">ko</span><span class="p">.</span><span class="nx">jsonExpressionRewriting</span><span class="p">.</span><span class="nx">writeValueToProperty</span><span class="p">(</span><span class="nx">modelValue</span><span class="p">,</span> <span class="nx">allBindingsAccessor</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="nx">elementValue</span><span class="p">,</span> <span class="cm">/* checkIfDifferent: */</span> <span class="kc">true</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>elementValue holds the changed value which is in the next line synced back.</p>

<p>So here is an overview of how bindings work : when you call <strong>ko.applyBindings</strong> the library traverses the DOM hunting for data-bind attributes. When it finds a data-bind attribute – it first of all figures out which bindingHandler is to be called from the part of data-bind attribute value that preceded the colon. The corresponding handler’s update method set to be called each time the value of corresponding view model attribute changes and it is the responsibility of the update method to alter the DOM node as directed by the data-bind specification.</p>

<p>For those nodes which are editable by user (ie. the form elements) the corresponding bindingHandlers also have an init method which sets up the bindings for reverse synchronization.</p>

<p>This summarizes the way data-bindings work under the hood. I hope that this post helps to improve your understanding of KO library.</p>

  
  <footer class="group">
    <p>
      
      
      
        
      
    </p>
  </footer>
  
    <script>
      $(function() {
        (new Kudos({name:"kudos_"+ Math.floor(new Date().getTime() * Math.random()), articleId:"", articleTitle: "Effectively debugging KnockoutJS applications.", articleUrl:"/2012/08/12/effectively-debugging-knockoutjs-applications.html"})).render($("article#"));
        (new Kudos({name:"2kudos_"+ Math.floor(new Date().getTime() * Math.random()), articleId:"", articleTitle: "Effectively debugging KnockoutJS applications.", articleUrl:"/2012/08/12/effectively-debugging-knockoutjs-applications.html"})).render($(".group"));
      });
    </script>
    
  <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'lorefnon-blog'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</article>


      </div>
      
      <div class="line hide-text">Separator line</div>

      <!-- Next article preview -->
      <div class="next-article" style="display: none;">
        <a href="#">
          <p class="read-next tag is-uppercase">Read this next:</p>
          <p class="next-article__title">Protocol and Language</p>
          <div class="next-article__content">
            <p>This is the second part of my series on protocol. The first part contained a lot of background information, but now we’re ready to get into what Protocol actually is. I live in a pretty unique place, the Farmhouse. It’s a... <span>Continue…</span></p>
          </div>
        </a>
      </div>
      <!-- Finish / Feature on process-->

      <div class="line hide-text">Separator line</div>

      <div class="foot_logo">
        <a href="http://lorefnon.me"><span class="logo"></span></a>
      </div>

      <div class="foot_logo right">
        <a href="/"><span class="link">Full Blog >></span></a>
      </div>

      <div class="foot_userbar">
        <a href="#" class="bottom_tagline">
          <span>Lorefnon</span> - Notes On Software Craftsmanship, Architecture Design And The Art Of Building Beautiful Abstractions, Primary Focus Being On Web Centric Platforms And Technologies.
        </a>
        <a href="https://twitter.com/@lorefnon" class="linkout twitter">
          <i class="fa fa-twitter"></i>
          @lorefnon
        </a>
        <a href="mailto:lorefnon@gmail.com" target="_blank" class="linkout contact">Contact</a>
      </div>
      <div class="line">
      </div>
      <div class="foot_userbar">
        <p>&copy; 2013 - 2015 Gaurab Paul </p>
<br/>
<p>Code licensed under the
  <a href="http://opensource.org/licenses/MIT" target="_blank">The
    MIT License</a>. Content and Artwork licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA</a>.
</p>
<br/>
<p>
  The opinions expressed herein are my personal viewpoints  and may
  not be taken as professional recommendations from any of my previous or
  current employers.
</p>
<br/>
<p>
  Site is powered by <a href="http://jekyllrb.com/">Jekyll</a> and graciously hosted by <a href="https://github.com">Github</a>
</p>
<br/>
<br/>
        
      </div>
    </div>

    <div class="side-nav-container">
      <h3 class="logotype"><a class="is-uppercase tag" href="#">Menu</a></h3>
      <nav class="side-nav">
        <div class="top">
          <p>
						Check more on: 
            <a href="http://lorefnon.me"><span class="tag">Code.Art.Web</span></a> 
          </p>
          <ul class="nav-profile-links">
            <li class="website">
              <a href="http://lorefnon.me">Lorefnon</a>
            </li>
            <li class="twitter">
              <a href="http://twitter.com/lorefnon">@lorefnon</a>
            </li>
            <li class="email">
              <a href="mailto:lorefnon@gmail.com">Contact</a>
            </li>
          </ul>
        </div>
        <div class="about">
          <ul class="about-links">
            <li>
              <a href="#">
                <span class="tag">RSS</span>
              </a>
            </li>
            <li class="magazine">
              <a href="http://lorefnon.me/feed.xml">Feed</a>
            </li>
          </ul>
        </div>
      </nav>
    </div>

    <script src="/assets/javascripts/js.js"></script>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-47274059-1']);
      _gaq.push(['_setDomainName', 'lorefnon.me']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
