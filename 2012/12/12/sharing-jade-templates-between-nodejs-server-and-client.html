<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]> ><! <![endif]-->
<html lang="en" class="">
  <head>
    <meta charset="utf-8">
    <title>Sharing Jade templates between Node.js server and client |  Code.Art.Web</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="One of the biggest promises of Node.js is code re-use across client and server - this post focusses on reusing server side templates on client as well for dynamic rendering.">
    <link rel="canonical" href="http://lorefnon.me/2012/12/12/sharing-jade-templates-between-nodejs-server-and-client.html">
    <meta property="twitter:creator" content="@lorefnon">
    <meta property="og:title" content="@lorefnon">
    <meta property="og:type" content="blog">
    <meta poperty="og:url" content="http://lorefnon.me">
    <meta property="og:site_name" content="Code.Art.Web">
    <meta property="og:fb:app_id">
    <meta property="og:description" content="One of the biggest promises of Node.js is code re-use across client and server - this post focusses on reusing server side templates on client as well for dynamic rendering.">
    <link rel="alternate" type="application/rss+xml" href="http://lorefnon.me/feed.xml"/>
    <link rel="stylesheet" media="screen" type="text/css" href="/assets/stylesheets/reset.css"/>
    <link rel="stylesheet" media="screen" type="text/css" href="/assets/stylesheets/styles.css"/>
    <link rel="stylesheet" media="screen" type="text/css" href="/assets/stylesheets/responsive.css"/>
    <link rel="stylesheet" media="screen" type="text/css" href="/assets/stylesheets/github.css"/>
    <link rel="stylesheet" media="screen" type="text/css" href="/assets/stylesheets/minimal_lightbox.css"/>    
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
  </head>
  <body style="zoom: 1;">
    <div class="main-container">
      
      <div class="mlogotype is-uppercase">
        <a href="http://lorefnon.me">Code.Art.Web</a>
      </div>

      <a href="http://lorefnon.me" class="home_logotype_link">
        <h1 class="tag">Code.Art.Web</h1>
      </a>

      <div class="header-container detail-view">
        <header class="main-header">
          <figure class="avatar">
            <a href="http://lorefnon.me" 
            style="background-image: url();">Profile Picture</a> 
          </figure>
          <h1 class="profile-name is-uppercase">
            <a href="http://lorefnon.me">Lorefnon</a>
          </h1>
        </header>
      </div>

      <div class="posts-container detail-view">
        

<header class="post-header">
  <!-- <time datetime="2015-12-02 02:25:59 +0530">December 12, 2012</time> -->
</header>

<article class="post detail-view" id="">
  <h1 class="title"><a href="#">Sharing Jade templates between Node.js server and client</a></h1>
  <a href="#" class="anchor-icon">
    <i class="fa fa-anchor"></i>
    <time datetime="2015-12-02 02:25:59 +0530">Dec 12, 2012</time>
  </a>
  
    <p>Although there are several templating options available for the client eg. <a href="http://www.lorefnon.com/blog/handlebarsjs.com">Handlebars</a>, <a href="http://www.lorefnon.com/blog/mustache.github.com">Mustache</a>, <a href="http://www.lorefnon.com/blog/beebole.com/pure/">Pure</a> etc. nevertheless, <a href="http://www.lorefnon.com/blog/jade-lang.com/">Jade</a> is attractive in its own right.  Its succinct syntax is cleaner even than <a href="http://www.lorefnon.com/blog/haml.info">Haml</a>, which is arguably the predecessor and inspiration-source of all the minimalist whitespace sensitive templating systems. Using Node.js on the server offers an interesting opportunity to reuse the same servers on the server as well as client. This has been made particulary easy by the <a href="https://github.com/search?q=jade&amp;ref=commandbar">numerous community contributions</a> by Jade enthusiasts which I will attempt to highlight in this post.</p>

<p>When using Jade on the client the most naive approach would be  fetching our typical .jade file via ajax and then parsing the file and then  manipulating the structure and  interpolating the various variables. However,  we can pre-process the jade file beforehand thereby eliminating the heavyweight parsing step in the client. The end result of the pre-processing is a function which takes in the variables needed to render the template and then outputs the resultant HTML string which can be injected into the DOM.</p>

<p>Preprocessing also takes care of <a href="https://github.com/visionmedia/jade#template-inheritance">template-inheritance</a> and <a href="https://github.com/visionmedia/jade#includes">template-inclusion</a> seamlessly which are difficult to implement in pure clienside parsing without an added layer of complexity and overhead of multiple ajax calls.</p>

<p>Client-side rendering is made possible by a Jade feature called jade-runtime. On supplying a -c flag to jade, it generates the compiled javascript template which can be used along with the <a href="https://github.com/visionmedia/jade/blob/master/runtime.js">runtime.js</a> .</p>

<p><a href="https://github.com/jgallen23/clientjade">Clientjade</a> takes the process to next level of simplicity.  It is simple npm module which provides you with a command line utility to compile several jade templates into a single compiled javascript file. Compilation is as simple as:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">clientjade test1.jade test2.jade &gt; templates.js
</code></pre></div>
<p>Once templates.js has been included in the page,  individual templates can be accessed using their filenames.</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">jade.render($(&#39;#target&#39;), &#39;test1&#39;, { name: &#39;Bob&#39; });
</code></pre></div>
<p>First argument is the DOM node where the template is to be rendered, second is a reference to the template and last is the data required to render the template.</p>

<p>While this entire procedure is very simple, inclusion of multiple compiled templates in an HTML page leads to headaches.  Reason is that every individual compiled file assigns an empty hash to internal object containing references to templates. While in casual usage this is usually not a problem because you can always compile all the templates you need into a single javascript file, this can become troublesome if you are loading templates on-the-fly, as per requirements. The most common scenario is the case when an AMD loader eg. RequireJS is being used to manage dependencies.</p>

<p>Fortunately there is a sister project <a href="https://github.com/mysociety/node-jade-amd">node-jade-amd</a> which focusses on exactly this usage scenario. As you might expect, after installing the <a href="https://github.com/mysociety/node-jade-amd">jade-amd</a> npm module you have a handy command line utility using which is as simple as :</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">jade-amd --from &lt;source-folder&gt; --to &lt;destination-folder&gt;
</code></pre></div>
<p>The compiled templates have a dependency on jadeRuntime amd module which can be obtained by :</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">jade-amd --runtime &gt; jadeRuntime.js
</code></pre></div>
<p>Then the compiled template can be used just like you would use any other amd module :</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">require</span><span class="p">([</span> <span class="s1">&#39;templates/person&#39;</span> <span class="p">],</span>            <span class="c1">// Compiled template AMD modules</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">personTemplate</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">rendered_content</span> <span class="o">=</span> <span class="nx">personTemplate</span><span class="p">({</span>
              <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Joe Bloggs&#39;</span>                <span class="c1">// Data to be used in the template</span>
         <span class="p">});</span>
    <span class="p">}</span>
<span class="p">);</span>
</code></pre></div>

<p>Note that explitly requiring the runtime is not necessary because it is implicitly required by the compiled templates.</p>

<p>If repeated manual recompilation feels like a headache, and you donâ€™t already have a file watcher setup there is a connect middleware <a href="https://github.com/storify/jade-browser">jade-browser</a> which exposes jade templates to the web browser and also provides a few additional features like express-like render function with partial handling. If you already using <a href="http://www.lorefnon.com/blog/gruntjs.com">grunt</a>, you can checkout the plugin <a href="https://github.com/phated/grunt-jade">grunt-jade</a> .</p>

<p>So jade is an immensely popular templating solution among Node.js developers and the benefit of this is that there are numerous compilation options available to fit into your development toolchain.  I hope this quick detour around jade was helpful.  There are multiple other similar projects aiming to solve similar scenarios.  The ones aforementioned, were a few that I recently used. Please feel free to express any opinions or criticisms. If there is a project with related objectives which is particularly noteworthy,  feel free to add a link.</p>

  
  <footer class="group">
    <p>
      
      
      
        
      
    </p>
  </footer>
  <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'lorefnon-blog'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</article>


      </div>
      
      <div class="line hide-text">Separator line</div>

      <!-- Next article preview -->
      <div class="next-article" style="display: none;">
        <a href="#">
          <p class="read-next tag is-uppercase">Read this next:</p>
          <p class="next-article__title">Protocol and Language</p>
          <div class="next-article__content">
            <p>This is the second part of my series on protocol. The first part contained a lot of background information, but now weâ€™re ready to get into what Protocol actually is. I live in a pretty unique place, the Farmhouse. Itâ€™s a... <span>Continueâ€¦</span></p>
          </div>
        </a>
      </div>
      <!-- Finish / Feature on process-->

      <div class="line hide-text">Separator line</div>

      <div class="foot_logo">
        <a href="http://lorefnon.me"><span class="logo"></span></a>
      </div>

      <div class="foot_logo right">
        <a href="/"><span class="link">Full Blog >></span></a>
      </div>

      <div class="foot_userbar">
        <a href="#" class="bottom_tagline">
          <span>Lorefnon</span> - Notes On Software Craftsmanship, Architecture Design And The Art Of Building Beautiful Abstractions, Primary Focus Being On Web Centric Platforms And Technologies.
        </a>
        <a href="https://twitter.com/@lorefnon" class="linkout twitter">
          <i class="fa fa-twitter"></i>
          @lorefnon
        </a>
        <a href="mailto:lorefnon@gmail.com" target="_blank" class="linkout contact">Contact</a>
      </div>
      <div class="line">
      </div>
      <div class="foot_userbar">
        <p>&copy; 2013 - 2015 Gaurab Paul </p>
<br/>
<p>Code licensed under the
  <a href="http://opensource.org/licenses/MIT" target="_blank">The
    MIT License</a>. Content and Artwork licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA</a>.
</p>
<br/>
<p>
  The opinions expressed herein are my personal viewpoints  and may
  not be taken as professional recommendations from any of my previous or
  current employers.
</p>
<br/>
<p>
  Site is powered by <a href="http://jekyllrb.com/">Jekyll</a> and graciously hosted by <a href="https://github.com">Github</a>
</p>
<br/>
<br/>
        
      </div>
    </div>

    <div class="side-nav-container">
      <h3 class="logotype"><a class="is-uppercase tag" href="#">Menu</a></h3>
      <nav class="side-nav">
        <div class="top">
          <p>
						Check more on: 
            <a href="http://lorefnon.me"><span class="tag">Code.Art.Web</span></a> 
          </p>
          <ul class="nav-profile-links">
            <li class="website">
              <a href="http://lorefnon.me">Lorefnon</a>
            </li>
            <li class="twitter">
              <a href="http://twitter.com/lorefnon">@lorefnon</a>
            </li>
            <li class="email">
              <a href="mailto:lorefnon@gmail.com">Contact</a>
            </li>
          </ul>
        </div>
        <div class="about">
          <ul class="about-links">
            <li>
              <a href="#">
                <span class="tag">RSS</span>
              </a>
            </li>
            <li class="magazine">
              <a href="http://lorefnon.me/feed.xml">Feed</a>
            </li>
          </ul>
        </div>
      </nav>
    </div>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-47274059-1']);
      _gaq.push(['_setDomainName', 'lorefnon.me']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <script src="/assets/javascripts/post.js"></script>

  </body>
</html>
